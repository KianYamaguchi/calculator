<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>電卓</title>
    <link rel="stylesheet" href="/home.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <h1>電卓</h1>
    <div class="header-bar">
        <div class="header-content">
            <span class="user-info">
                <i class="fa-solid fa-user"></i>
                ログイン中: <%= session.user.username %>
            </span>
            <button type="button" class="logout-btn" onclick="location.href='/logout'">Logout</button>
        </div>
    </div>
    <form id="calcForm" autocomplete="off" onsubmit="return calculateResult();">
        <input id="display" type="text" name="expression" placeholder="計算式" readonly aria-label="計算式">
        <br>
        <div>
            <button type="button" class="calc-btn" onclick="addChar('7')">7</button>
            <button type="button" class="calc-btn" onclick="addChar('8')">8</button>
            <button type="button" class="calc-btn" onclick="addChar('9')">9</button>
            <button type="button" class="calc-btn" onclick="addChar('/')">÷</button>
        </div>
        <div>
            <button type="button" class="calc-btn" onclick="addChar('4')">4</button>
            <button type="button" class="calc-btn" onclick="addChar('5')">5</button>
            <button type="button" class="calc-btn" onclick="addChar('6')">6</button>
            <button type="button" class="calc-btn" onclick="addChar('*')">×</button>
        </div>
        <div>
            <button type="button" class="calc-btn" onclick="addChar('1')">1</button>
            <button type="button" class="calc-btn" onclick="addChar('2')">2</button>
            <button type="button" class="calc-btn" onclick="addChar('3')">3</button>
            <button type="button" class="calc-btn" onclick="addChar('-')">−</button>
        </div>
        <div>
            <button type="button" class="calc-btn" onclick="addChar('0')">0</button>
            <button type="button" class="calc-btn" onclick="addChar('.')">.</button>
            <button type="button" class="calc-btn" onclick="clearDisplay()">C</button>
            <button type="button" class="calc-btn" onclick="addChar('+')">＋</button>
        </div>
        <div>
            <button type="submit" class="calc-btn" style="width: 170px;">=</button>
        </div>
        <div id="result" class="result"></div>
    </form>
    <script>
        function addChar(char) {
            if (char === '/' ) {
                document.getElementById('display').value += '÷';
            } else if (char === '*') {
                document.getElementById('display').value += '×';
            } else {
                document.getElementById('display').value += char;
            }
        }
        function clearDisplay() {
            document.getElementById('display').value = '';
            document.getElementById('result').textContent = '';
        }
        function calculateResult() {
            const display = document.getElementById('display');
            let expr = display.value.replace(/÷/g, '/').replace(/×/g, '*');
            try {
                // evalは安全ではないので、実運用ではmath.jsなど推奨
                let result = eval(expr);
                document.getElementById('result').textContent = '計算結果: ' + result;
                display.value = result; // 結果を表示欄にセット
            } catch (e) {
                document.getElementById('result').textContent = '無効な計算式です';
            }
            return false; // フォーム送信をキャンセル
        }
    </script>
</body>
</html>